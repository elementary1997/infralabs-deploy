# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ALLOWED_HOSTS

Django —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤ –≤ `ALLOWED_HOSTS` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `ALLOWED_HOSTS` –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

## –ß—Ç–æ —Ç–∞–∫–æ–µ ALLOWED_HOSTS?

`ALLOWED_HOSTS` - —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –∏ IP-–∞–¥—Ä–µ—Å–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã—Ö Django —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã. –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞—Ç–∞–∫ —Ç–∏–ø–∞ HTTP Host header attack.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ .env —Ñ–∞–π–ª

–í —Ñ–∞–π–ª–µ `.env` —É–∫–∞–∂–∏—Ç–µ —Ö–æ—Å—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:

```bash
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1
```

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1
```

### Production —Å –æ–¥–Ω–∏–º –¥–æ–º–µ–Ω–æ–º

```bash
DJANGO_ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com
```

### Production —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏

```bash
DJANGO_ALLOWED_HOSTS=example.com,www.example.com,api.example.com
```

### –°–º–µ—à–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–æ–º–µ–Ω—ã + IP)

```bash
DJANGO_ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com,192.168.1.100,10.0.0.50
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤

```bash
DJANGO_ALLOWED_HOSTS=*.example.com,example.com
```

‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Wildcard –ø–æ–¥–¥–æ–º–µ–Ω—ã (`*.example.com`) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
DJANGO_ALLOWED_HOSTS=localhost:8000,127.0.0.1:8000
```

‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Ä—Ç—ã –æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–Ω—ã –≤ production, —Ç–∞–∫ –∫–∞–∫ Django —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ reverse proxy (nginx).

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç init.sh

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ `scripts/init.sh` –≤–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤–≤–µ—Å—Ç–∏ ALLOWED_HOSTS –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ:

```bash
./scripts/init.sh
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç:
```
üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ALLOWED_HOSTS
   –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω—ã/IP –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è localhost,127.0.0.1):
   > 
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –∏ CSRF

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `ALLOWED_HOSTS` —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ:

### CORS_ALLOWED_ORIGINS

–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è CORS –∑–∞–ø—Ä–æ—Å–æ–≤:

```bash
# –î–ª—è HTTP
CORS_ALLOWED_ORIGINS=http://yourdomain.com,http://www.yourdomain.com

# –î–ª—è HTTPS
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```

### CSRF_TRUSTED_ORIGINS

–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è CSRF:

```bash
# –î–ª—è HTTPS (production)
CSRF_TRUSTED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# –î–ª—è HTTP (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
CSRF_TRUSTED_ORIGINS=http://localhost,http://127.0.0.1
```

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è?

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω –≤ `DJANGO_ALLOWED_HOSTS`:

```bash
# –ë—ã–ª–æ
DJANGO_ALLOWED_HOSTS=example.com

# –°—Ç–∞–ª–æ
DJANGO_ALLOWED_HOSTS=example.com,newdomain.com
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ web —Å–µ—Ä–≤–∏—Å:

```bash
docker-compose restart web
```

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–ª—É—á–∞—é –æ—à–∏–±–∫—É "DisallowedHost"?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω/IP —É–∫–∞–∑–∞–Ω –≤ `DJANGO_ALLOWED_HOSTS`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏ web —Å–µ—Ä–≤–∏—Å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `.env` –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –≤–æ–∫—Ä—É–≥ –∑–∞–ø—è—Ç—ã—Ö

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å?

–î–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å–∞:

```bash
DJANGO_ALLOWED_HOSTS=192.168.1.100,10.0.0.50
```

### –ù—É–∂–Ω–æ –ª–∏ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Ä—Ç?

–í production –æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ Django —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ nginx. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å:

```bash
DJANGO_ALLOWED_HOSTS=localhost:8000
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å nginx reverse proxy?

–ö–æ–≥–¥–∞ nginx —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ reverse proxy, Django –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç nginx (–æ–±—ã—á–Ω–æ `127.0.0.1`), –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Host` –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ—ç—Ç–æ–º—É –≤ `ALLOWED_HOSTS` –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –¥–æ–º–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞ –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é?

–î–∞, –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ docker-compose:

```bash
DJANGO_ALLOWED_HOSTS=example.com,www.example.com docker-compose up -d
```

–ù–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec web python manage.py shell -c "from django.conf import settings; print(settings.ALLOWED_HOSTS)"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ DisallowedHost
docker-compose logs web | grep -i "disallowedhost"
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

1. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `*` –≤ production** - —ç—Ç–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ö–æ—Å—Ç–æ–≤
2. **–£–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã** –≤–º–µ—Å—Ç–æ wildcard, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
3. **–ù–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ IP –∞–¥—Ä–µ—Å–∞ Docker —Å–µ—Ç–∏** –≤ production
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ production** –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `CSRF_TRUSTED_ORIGINS`
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ** —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤ –∏ —É–¥–∞–ª—è–π—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ

## –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (Development)

```bash
DJANGO_DEBUG=True
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,0.0.0.0
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost
CSRF_TRUSTED_ORIGINS=http://localhost,http://127.0.0.1
```

### Staging

```bash
DJANGO_DEBUG=False
DJANGO_ALLOWED_HOSTS=staging.yourdomain.com,staging-ip.yourdomain.com
CORS_ALLOWED_ORIGINS=https://staging.yourdomain.com
CSRF_TRUSTED_ORIGINS=https://staging.yourdomain.com
```

### Production

```bash
DJANGO_DEBUG=False
DJANGO_ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com,api.yourdomain.com
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
CSRF_TRUSTED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```
